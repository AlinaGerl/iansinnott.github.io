webpackJsonp([0xc8882ce95333e800],{"./node_modules/json-loader/index.js!./.cache/json/switching-away-from-mongoose.json":function(n,a){n.exports={data:{post:{html:'<p>I\'ve been using MongoDB as my primary database for some time now. That means all new projects I created were running Mongo, and Mongoose was my ORM of choice. Mongoose has worked well for my in the past and even <em>still</em> does, but I can feel that it\'s time for a switch.</p>\n<h2 id="why-the-change"><a href="#why-the-change" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why the change?</h2>\n<h3 id="mongo"><a href="#mongo" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mongo</h3>\n<p>The main reason actually isn\'t Mongoose, but rather <strong>Mongo</strong>. The data in <em>most</em> applications is probably going to be relational so why would you use a non-relational database? The main reason I liked Mongo initially was that it had a JavaScript API but I\'ve come to realize that doesn\'t matter that much, and it can even be a hindrance when working with team members that know and love SQL.</p>\n<h3 id="mpromise"><a href="#mpromise" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mpromise</h3>\n<p>For anyone who doesn\'t know already, Mongoose provides a promise-based API for doing async database operations in addition to the classic callbacks. This API is unfortunately under documented, but it exists none-the-less and the library it uses to implement promises is <a href="https://github.com/aheckmann/mpromise">Mpromise</a>.</p>\n<p>Mpromise seemed fine at first, but it turns out it simply doesn\'t adhere to the ES6 Promise spec. The most glaring example of this is that Mpromise does not implement <code>.catch</code>, meaning you can\'t do nice pretty error handling at the bottom of your then-stack. Here\'s an example using Express to build an API:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token keyword">import</span> Model <span class="token keyword">from</span> <span class="token string">\'../models/Model.js\'</span><span class="token punctuation">;</span>\n\n<span class="token comment" spellcheck="true">// GET all the Models</span>\napi<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'/models\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>\n  Model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<!-- more -->\n<p>The above code will break, throwing an error because an Mpromise Promise has no <code>catch</code> method. There\'s even an <a href="https://github.com/aheckmann/mpromise/issues/15">open issue about this</a> from <em>last year</em>. That\'s probably already a dealbreaker, but we can get around this by patching Mpromise ourself:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token keyword">var</span> mpromise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'mongoose/node_modules/mpromise\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmpromise<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">catch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>onReject<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>undefined<span class="token punctuation">,</span> onReject<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>Still, this is ugly and should not be necessary with the myriad promise libraries in addition to the rollout of ES6 (We can currently use native Promises in Chrome and FF).</p>\n<h2 id="so-what-now"><a href="#so-what-now" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>So what now?</h2>\n<p>Well, despite what I said about Mongo earlier it\'s still the database I know best. For this reason I\'m going to keep on using it in the interim while I survey the state of relational database support in the Node ecosystem. There are a number of interesting libraries currently out there. Here are a few:</p>\n<ul>\n<li><a href="https://github.com/tgriesser/knex">https://github.com/tgriesser/knex</a></li>\n<li><a href="https://github.com/tgriesser/bookshelf">https://github.com/tgriesser/bookshelf</a></li>\n<li><a href="https://github.com/balderdashy/waterline">https://github.com/balderdashy/waterline</a></li>\n</ul>\n<p>I\'m currently leaning toward Waterline, as I tried out Bookshelf and wasn\'t a fan of the API. That being said, the whole idea of query building with Knex is interesting, and allows simple application of existing relational DB knowledge to a Node app.</p>\n<p>I\'m not sure what my ideal stack will be in a couple months, but for now I\'m trying out some new things in the hope of discovering the "ultimate" stack. Maybe I\'ll get tired of writing out all my routing logic with Express and switch to <a href="https://github.com/balderdashy/sails">Sails</a> or <a href="https://github.com/strongloop/loopback">Loopback</a>... or better yet maybe I\'ll get fed up with JS all together and switch to a Clojure-ClojureScript stack. I\'d really love to start using <a href="https://github.com/omcljs/om">Om</a> right now, but the overhead of getting up to speed with ClojureScript would cause a serious hit to my immediate productivity.</p>',frontmatter:{created:"2015-08-01T07:00:00.000Z",title:"Switching Away From Mongoose"}}},pathContext:{id:"/Users/jandrix/dev/sites/blog.iansinnott.com/content/_posts/2015-08-01-switching-away-from-mongoose.md absPath of file >>> MarkdownRemark",next:{frontmatter:{title:"Teaching a React.js Workshop",created:"2016-02-27T08:00:00.000Z"},slug:"teaching-a-reactjs-workshop"},prev:{frontmatter:{title:"Use SSH ForwardAgent for fun and profit",created:"2015-07-20T07:00:00.000Z"},slug:"use-ssh-forwardagent-for-fun-and-profit"}}}}});
//# sourceMappingURL=path---switching-away-from-mongoose-65f5408001f06450d41a.js.map