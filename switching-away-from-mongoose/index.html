<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Switching Away From Mongoose | Ian Sinnott</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I’ve been using MongoDB as my primary database for some time now. That means all new projects I created were running Mongo, and Mongoose was my ORM of choice. Mongoose has worked well for my in the pa">
<meta property="og:type" content="article">
<meta property="og:title" content="Switching Away From Mongoose">
<meta property="og:url" content="https://blog.iansinnott.com/switching-away-from-mongoose/index.html">
<meta property="og:site_name" content="Ian Sinnott">
<meta property="og:description" content="I’ve been using MongoDB as my primary database for some time now. That means all new projects I created were running Mongo, and Mongoose was my ORM of choice. Mongoose has worked well for my in the pa">
<meta property="og:updated_time" content="2017-07-09T03:49:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Switching Away From Mongoose">
<meta name="twitter:description" content="I’ve been using MongoDB as my primary database for some time now. That means all new projects I created were running Mongo, and Mongoose was my ORM of choice. Mongoose has worked well for my in the pa">
  
    <link rel="alternate" href="/atom.xml" title="Ian Sinnott" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/style.css">
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52511246-1', 'auto');
  ga('send', 'pageview');

</script>


</head>
<body>
  <div
    data-event-handler='touchstart:show'
    data-target='.hidden-nav'
    id="container">
    <div id="wrap">
      <header id='header' class='outer'>
  <nav class='left-nav'>
    <a class='main-nav-link' href='/'>
      <img src='https://dropsinn.s3.amazonaws.com/face.jpg' alt='Face image' />
      Ian Sinnott
    </a>
  </nav>
  <div class='nav-menu'>
    <nav class='hidden-nav'>
      <button
        data-event-handler='touchstart:toggle,click:toggle,touchend:preventDefault'
        data-target='.hidden-nav'
        class='toggle'>
        <div class='burger'>
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>
      <a href='/'>
        <i class="fa fa-home"></i>
        Home
      </a>
      <a href='/archives'>
        <i class="fa fa-list-ul"></i>
        Archive
      </a>
      <a href='/tags'>
        <i class="fa fa-tags"></i>
        Tags
      </a>

      <hr />

      <a href="https://www.iansinnott.com/">
        <i class="fa fa-flag"></i>
        Site
      </a>
      <a href="https://twitter.com/ian_sinn">
        <i class="fa fa-twitter"></i>
        Twitter
      </a>
      <a href="https://github.com/iansinnott">
        <i class="fa fa-github"></i>
        GitHub
      </a>

      <div class='face'>
        <img src='https://dropsinn.s3.amazonaws.com/face2.jpg' alt='Hand drawn face' />
        <h3>Hello</h3>
      </div>
    </nav>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-switching-away-from-mongoose" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/switching-away-from-mongoose/" class="article-date">
  <time datetime="2015-08-01T07:00:00.000Z" itemprop="datePublished">2015-08-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Switching Away From Mongoose
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve been using MongoDB as my primary database for some time now. That means all new projects I created were running Mongo, and Mongoose was my ORM of choice. Mongoose has worked well for my in the past and even <em>still</em> does, but I can feel that it’s time for a switch.</p>
<h2 id="Why-the-change"><a href="#Why-the-change" class="headerlink" title="Why the change?"></a>Why the change?</h2><h3 id="Mongo"><a href="#Mongo" class="headerlink" title="Mongo"></a>Mongo</h3><p>The main reason actually isn’t Mongoose, but rather <strong>Mongo</strong>. The data in <em>most</em> applications is probably going to be relational so why would you use a non-relational database? The main reason I liked Mongo initially was that it had a JavaScript API but I’ve come to realize that doesn’t matter that much, and it can even be a hindrance when working with team members that know and love SQL.</p>
<h3 id="Mpromise"><a href="#Mpromise" class="headerlink" title="Mpromise"></a>Mpromise</h3><p>For anyone who doesn’t know already, Mongoose provides a promise-based API for doing async database operations in addition to the classic callbacks. This API is unfortunately under documented, but it exists none-the-less and the library it uses to implement promises is <a href="https://github.com/aheckmann/mpromise" target="_blank" rel="external">Mpromise</a>.</p>
<p>Mpromise seemed fine at first, but it turns out it simply doesn’t adhere to the ES6 Promise spec. The most glaring example of this is that Mpromise does not implement <code>.catch</code>, meaning you can’t do nice pretty error handling at the bottom of your then-stack. Here’s an example using Express to build an API:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> Model <span class="keyword">from</span> <span class="string">'../models/Model.js'</span>;</div><div class="line"></div><div class="line"><span class="comment">// GET all the Models</span></div><div class="line">api.get(<span class="string">'/models'</span>, (req, res, next) =&gt; &#123;</div><div class="line">  Model.find(&#123;&#125;)</div><div class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> res.send(data))</div><div class="line">    .catch(next);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>The above code will break, throwing an error because an Mpromise Promise has no <code>catch</code> method. There’s even an <a href="https://github.com/aheckmann/mpromise/issues/15" target="_blank" rel="external">open issue about this</a> from <em>last year</em>. That’s probably already a dealbreaker, but we can get around this by patching Mpromise ourself:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> mpromise = <span class="built_in">require</span>(<span class="string">'mongoose/node_modules/mpromise'</span>);</div><div class="line"></div><div class="line">mpromise.prototype.catch = <span class="function"><span class="keyword">function</span>(<span class="params">onReject</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">undefined</span>, onReject);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Still, this is ugly and should not be necessary with the myriad promise libraries in addition to the rollout of ES6 (We can currently use native Promises in Chrome and FF).</p>
<h2 id="So-what-now"><a href="#So-what-now" class="headerlink" title="So what now?"></a>So what now?</h2><p>Well, despite what I said about Mongo earlier it’s still the database I know best. For this reason I’m going to keep on using it in the interim while I survey the state of relational database support in the Node ecosystem. There are a number of interesting libraries currently out there. Here are a few:</p>
<ul>
<li><a href="https://github.com/tgriesser/knex" target="_blank" rel="external">https://github.com/tgriesser/knex</a></li>
<li><a href="https://github.com/tgriesser/bookshelf" target="_blank" rel="external">https://github.com/tgriesser/bookshelf</a></li>
<li><a href="https://github.com/balderdashy/waterline" target="_blank" rel="external">https://github.com/balderdashy/waterline</a></li>
</ul>
<p>I’m currently leaning toward Waterline, as I tried out Bookshelf and wasn’t a fan of the API. That being said, the whole idea of query building with Knex is interesting, and allows simple application of existing relational DB knowledge to a Node app.</p>
<p>I’m not sure what my ideal stack will be in a couple months, but for now I’m trying out some new things in the hope of discovering the “ultimate” stack. Maybe I’ll get tired of writing out all my routing logic with Express and switch to <a href="https://github.com/balderdashy/sails" target="_blank" rel="external">Sails</a> or <a href="https://github.com/strongloop/loopback" target="_blank" rel="external">Loopback</a>… or better yet maybe I’ll get fed up with JS all together and switch to a Clojure-ClojureScript stack. I’d really love to start using <a href="https://github.com/omcljs/om" target="_blank" rel="external">Om</a> right now, but the overhead of getting up to speed with ClojureScript would cause a serious hit to my immediate productivity.</p>

      
    </div>
    <footer class="article-footer">
      <div class='share-menu'>
        <button class="article-share-link share-toggle">
          Share
        </button>
        <div class='share-box'>
          <input
            type='text'
            class='article-share-input'
            onfocus='this.setSelectionRange(0, this.value.length);'
            value='https://blog.iansinnott.com/switching-away-from-mongoose/' />
          <nav class='share-links'>
            
            <a
              href='https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.iansinnott.com%2Fswitching-away-from-mongoose%2F'
              target='_blank'
              class="share-link share-twitter"></a>
            <a
              href='https://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.iansinnott.com%2Fswitching-away-from-mongoose%2F'
              target='_blank'
              class="share-link share-facebook"></a>
            <a
              href='https://plus.google.com/share?url=https%3A%2F%2Fblog.iansinnott.com%2Fswitching-away-from-mongoose%2F'
              target='_blank'
              class="share-link share-google"></a>
          </nav>
        </div>
      </div>
      
        <a href="https://blog.iansinnott.com/switching-away-from-mongoose/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/">node</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/teaching-a-reactjs-workshop/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Teaching a React.js Workshop
        
      </div>
    </a>
  
  
    <a href="/use-ssh-forwardagent-for-fun-and-profit/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Use SSH ForwardAgent for fun and profit</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
      </div>
    </div>

    <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Ian Sinnott<br>
    </div>
  </div>
</footer>


    
    
    <script>
      var disqus_shortname = 'iansinnott';
      
      var disqus_url = 'https://blog.iansinnott.com/switching-away-from-mongoose/';
      
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    

    <script src="/js/main.js"></script>
  </div>
</body>
</html>
